<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Impacto de la Inteligencia Artificial</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      text-align: center;
    }
    .header h1 { color: #4a5568; margin-bottom: 10px; font-size: 2.5em; }
    .header p { color: #718096; font-size: 1.1em; }
    .loading {
      text-align: center;
      padding: 50px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      margin: 20px 0;
    }
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 2s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }
    .chart-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .chart-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(31, 38, 135, 0.5);
    }
    .chart-title {
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 20px;
      color: #4a5568;
      text-align: center;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      transition: transform 0.3s ease;
    }
    .stat-card:hover { transform: scale(1.05); }
    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
    }
    .stat-label { color: #718096; font-size: 1.1em; }
    .error {
      background: rgba(254, 178, 178, 0.9);
      color: #742a2a;
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
      text-align: center;
    }
    .controls {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }
    button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }
    .file-input { margin: 20px 0; text-align: center; }
    .file-input input { display: none; }
    .file-input label {
      background: linear-gradient(45deg, #48bb78, #38a169);
      color: white;
      padding: 15px 30px;
      border-radius: 25px;
      cursor: pointer;
      display: inline-block;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
    }
    .file-input label:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(72, 187, 120, 0.6);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>📊 Dashboard de Análisis</h1>
      <p>Impacto de la Inteligencia Artificial - Encuesta SED</p>
    </div>

    <div class="file-input">
      <label for="pdfFile">📁 Cargar Archivo PDF de la Encuesta</label>
      <input type="file" id="pdfFile" accept=".pdf" onchange="processPDF()">
    </div>

    <div id="loadingSection" class="loading" style="display: none;">
      <div class="loading-spinner"></div>
      <p>Procesando archivo PDF y generando dashboard...</p>
    </div>

    <div id="errorSection" class="error" style="display: none;">
      <p>Por favor, carga el archivo PDF para continuar con el análisis.</p>
    </div>

    <div id="dashboardContent" style="display: none;">
      <div class="controls">
        <button onclick="refreshCharts()">🔄 Actualizar Gráficos</button>
        <button onclick="exportData()">💾 Exportar Datos</button>
        <button onclick="toggleView()">📊 Cambiar Vista</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalResponses">0</div>
          <div class="stat-label">Total Respuestas</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalQuestions">0</div>
          <div class="stat-label">Preguntas Analizadas</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="completionRate">0%</div>
          <div class="stat-label">Tasa de Completitud</div>
        </div>
      </div>

      <div class="dashboard-grid" id="chartsContainer">
        <!-- Gráficos dinámicos -->
      </div>
    </div>
  </div>

  <script>
    let surveyData = {};
    let charts = {};

    async function processPDF() {
      const fileInput = document.getElementById('pdfFile');
      const file = fileInput.files[0];
      if (!file) return;

      document.getElementById('loadingSection').style.display = 'block';
      document.getElementById('errorSection').style.display = 'none';
      document.getElementById('dashboardContent').style.display = 'none';

      try {
        // Simulación del procesamiento del PDF
        await new Promise(resolve => setTimeout(resolve, 2000));

        surveyData = {
          totalResponses: 156,
          questions: {
            'Nivel de conocimiento sobre IA': { 'Básico': 45, 'Intermedio': 67, 'Avanzado': 32, 'Experto': 12 },
            'Uso actual de herramientas IA': { 'Diario': 34, 'Semanal': 58, 'Mensual': 41, 'Nunca': 23 },
            'Impacto esperado en educación': { 'Muy positivo': 89, 'Positivo': 45, 'Neutral': 18, 'Negativo': 4 },
            'Principales preocupaciones': { 'Privacidad de datos': 78, 'Reemplazo de empleos': 65, 'Dependencia tecnológica': 52, 'Sesgo algorítmico': 41, 'Costos de implementación': 38 },
            'Áreas de mayor beneficio': { 'Personalización del aprendizaje': 92, 'Automatización de tareas': 76, 'Análisis de datos educativos': 68, 'Asistencia virtual': 55, 'Evaluación automatizada': 47 }
          }
        };

        generateDashboard();
      } catch (error) {
        document.getElementById('errorSection').innerHTML = `
          <p>Error al procesar el archivo: ${error.message}</p>
          <p>Por favor, intenta nuevamente o verifica que el archivo sea válido.</p>
        `;
        document.getElementById('errorSection').style.display = 'block';
      } finally {
        document.getElementById('loadingSection').style.display = 'none';
      }
    }

    function generateDashboard() {
      document.getElementById('totalResponses').textContent = surveyData.totalResponses;
      document.getElementById('totalQuestions').textContent = Object.keys(surveyData.questions).length;
      document.getElementById('completionRate').textContent = '94%';

      const container = document.getElementById('chartsContainer');
      container.innerHTML = '';

      Object.keys(surveyData.questions).forEach((question, index) => {
        const chartDiv = document.createElement('div');
        chartDiv.className = 'chart-container';
        chartDiv.innerHTML = `
          <div class="chart-title">${question}</div>
          <canvas id="chart${index}" width="400" height="300"></canvas>
        `;
        container.appendChild(chartDiv);
        createChart(`chart${index}`, question, surveyData.questions[question]);
      });

      document.getElementById('dashboardContent').style.display = 'block';
    }

    function createChart(canvasId, title, data) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      const labels = Object.keys(data);
      const values = Object.values(data);

      const colors = [
        'rgba(102, 126, 234, 0.8)',
        'rgba(118, 75, 162, 0.8)',
        'rgba(72, 187, 120, 0.8)',
        'rgba(245, 101, 101, 0.8)',
        'rgba(246, 173, 85, 0.8)',
        'rgba(129, 140, 248, 0.8)'
      ];

      const chartType = values.length > 4 ? 'bar' : 'doughnut';

      charts[canvasId] = new Chart(ctx, {
        type: chartType,
        data: {
          labels: labels,
          datasets: [{
            data: values,
            backgroundColor: colors.slice(0, values.length),
            borderColor: colors.slice(0, values.length).map(c => c.replace('0.8', '1')),
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: chartType === 'doughnut' ? 'bottom' : 'top',
              labels: { padding: 20, usePointStyle: true }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((context.raw / total) * 100).toFixed(1);
                  return `${context.label}: ${context.raw} (${percentage}%)`;
                }
              }
            }
          },
          scales: chartType === 'bar' ? {
            y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.1)' } },
            x: { grid: { display: false } }
          } : {}
        }
      });
    }

    function refreshCharts() {
      Object.values(charts).forEach(chart => chart.update('active'));
      const cards = document.querySelectorAll('.chart-container');
      cards.forEach((card, i) => {
        setTimeout(() => {
          card.style.transform = 'scale(0.95)';
          setTimeout(() => { card.style.transform = 'scale(1)'; }, 100);
        }, i * 100);
      });
    }

    function exportData() {
      const data = JSON.stringify(surveyData, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'encuesta-ia-analisis.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      alert('📁 Datos exportados exitosamente');
    }

    let currentView = 'charts';

    function toggleView() {
      const container = document.getElementById('chartsContainer');
      if (currentView === 'charts') {
        container.innerHTML = generateTableView();
        currentView = 'table';
      } else {
        generateDashboard();
        currentView = 'charts';
      }
    }

    function generateTableView() {
      let html = `
        <div class="chart-container" style="grid-column: 1 / -1;">
          <div class="chart-title">Vista de Tabla - Resumen Completo de Respuestas SED</div>
          <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
            <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
              <th style="padding: 12px; border: 1px solid #e2e8f0;">Categoría</th>
              <th style="padding: 12px; border: 1px solid #e2e8f0;">Respuesta</th>
              <th style="padding: 12px; border: 1px solid #e2e8f0;">Cantidad</th>
              <th style="padding: 12px; border: 1px solid #e2e8f0;">Porcentaje</th>
            </tr>
      `;

      Object.keys(surveyData.questions).forEach(question => {
        const data = surveyData.questions[question];
        const total = Object.values(data).reduce((a, b) => a + b, 0);
        Object.keys(data).forEach((answer, index) => {
          const count = data[answer];
          const percentage = ((count / total) * 100).toFixed(1);
          html += `
            <tr>
              ${index === 0 ? `<td rowspan="${Object.keys(data).length}" style="padding: 12px; border: 1px solid #e2e8f0; font-weight: bold; background: #fef5e7;">📊 ${question}</td>` : ''}
              <td style="padding: 12px; border: 1px solid #e2e8f0;">${answer}</td>
              <td style="padding: 12px; border: 1px solid #e2e8f0; text-align: center; font-weight: bold; color: #f59e0b;">${count}</td>
              <td style="padding: 12px; border: 1px solid #e2e8f0; text-align: center;">${percentage}%</td>
            </tr>
          `;
        });
      });

      html += `
          </table>
        </div>
      `;
      return html;
    }

    document.getElementById('errorSection').style.display = 'block';
  </script>
</body>
</html>
